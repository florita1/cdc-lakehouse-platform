apiVersion: flink.apache.org/v1beta1
kind: FlinkDeployment
metadata:
  name: flink-session
  namespace: flink
spec:
  image: flink:1.17.2
  flinkVersion: v1_17
  serviceAccount: flink-sa
  mode: native
  flinkConfiguration:
    jobmanager.memory.process.size: "512m"
    taskmanager.memory.process.size: "1024m"
    taskmanager.numberOfTaskSlots: "2"
    execution.checkpointing.interval: "30s"
    state.checkpoints.dir: file:///flink-data/checkpoints
    metrics.reporter.prom.class: org.apache.flink.metrics.prometheus.PrometheusReporter
    metrics.reporter.prom.port: "9249"
  jobManager:
    replicas: 1
    resource:
      memory: "640m"
      cpu: 0.25
  taskManager:
    replicas: 1
    resource:
      memory: "1152m"
      cpu: 0.5
  podTemplate:
    metadata:
      labels:
        app: flink-session
    spec:
      serviceAccountName: flink-sa
      containers:
        - name: flink-main-container
          volumeMounts:
            - name: sql
              mountPath: /sql
      volumes:
        - name: sql
          configMap:
            name: flink-sql
